<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#FFD700">
<title>Tic Tac Toe</title>
<style>
  :root{
    --bg0:#0a0a0a;
    --bg1:#111;
    --bg2:#181818;
    --card:#0f0f12;
    --edge:#ffffff14;
    --edge-strong:#ffffff22;
    --text:#fafafa;
    --muted:#cfcfcf;

    --win:#c6ffb3;
    --radius:16px;
    --shadow-1:0 10px 34px rgba(0,0,0,.55);
    --shadow-2:0 6px 18px rgba(0,0,0,.45);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial;
    /* fixed, no-repeat background */
    background:
      radial-gradient(1000px 700px at -10% -20%, #1d1d1d 0%, transparent 55%) no-repeat fixed,
      radial-gradient(900px 700px at 110% 10%, #1b1b1b 0%, transparent 55%) no-repeat fixed,
      linear-gradient(180deg, var(--bg2), var(--bg0)) fixed;
    background-attachment: fixed, fixed, fixed;
    background-repeat: no-repeat, no-repeat, no-repeat;
    display:grid; place-items:center; padding:20px;
    overflow: hidden; /* avoid scroll jitter on mobile */
  }

  .app{
    width:min(94vw,560px); /* smaller container */
    display:flex; flex-direction:column; gap:12px;
  }

  .title{
    display:flex; align-items:center; gap:10px;
    font-weight:900; letter-spacing:.3px;
    font-size:clamp(18px,2.8vw,28px); /* smaller heading */
  }
  .spark{
    width:22px;height:22px;border-radius:8px;
    background: conic-gradient(from 120deg, #ffffff, #9aa0a6, #000000 70%, #ffffff);
    box-shadow: 0 8px 24px rgba(255,255,255,.15);
    animation: bob 3.2s ease-in-out infinite;
  }
  @keyframes bob{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }

  .row{
    display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
    background: linear-gradient(180deg, #141414, #0f0f0f);
    border-radius: var(--radius);
    border:1px solid var(--edge);
    padding:10px 12px;
    box-shadow: var(--shadow-1), inset 0 1px 0 #ffffff14, inset 0 -1px 0 #00000080;
  }

  .status{ font-weight:800; letter-spacing:.3px; font-size:14px }
  .badge{
    margin-left:8px; padding:5px 10px; border-radius:999px;
    font-size:11px; font-weight:900; color:#0d0f12;
    background: linear-gradient(135deg, #f5f5f5, #cfcfcf);
    box-shadow: 0 6px 16px rgba(255,255,255,.22);
  }

  .toggle{ display:flex; align-items:center; gap:8px; }
  .switch{
    appearance:none; width:54px; height:28px; border-radius:999px;
    background: linear-gradient(180deg,#1b1b1b,#0f0f0f);
    border:1px solid var(--edge-strong);
    position:relative; cursor:pointer;
    box-shadow: inset 0 2px 6px rgba(0,0,0,.6);
    transition: background .25s ease, border-color .25s ease;
  }
  .switch::after{
    content:""; position:absolute; top:50%; left:6px; transform:translateY(-50%);
    width:18px; height:18px; border-radius:50%;
    background: linear-gradient(180deg,#fff,#cfcfcf);
    box-shadow: 0 4px 12px rgba(255,255,255,.35);
    transition:left .25s ease;
  }
  .switch:checked{ background: linear-gradient(180deg,#232323,#101010); border-color:#ffffff33; }
  .switch:checked::after{ left:30px; }

  .board-card{
    background: linear-gradient(180deg, #151515, #0c0c0c);
    border-radius: calc(var(--radius) + 2px);
    border:1px solid var(--edge-strong);
    padding:12px; /* tighter padding */
    box-shadow: var(--shadow-1);
  }

  .board{
    width:100%;
    aspect-ratio:1;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:10px; /* smaller gap for compact card */
  }

  .cell{
    position:relative; overflow:hidden; border-radius:14px;
    background:
      radial-gradient(150px 120px at 30% 20%, #1f1f1f 0%, transparent 60%),
      linear-gradient(180deg, #121212, #0a0a0a);
    border:1px solid #ffffff12;
    display:grid; place-items:center;
    cursor:pointer;
    transition: transform .14s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
    box-shadow: var(--shadow-2);
    min-height: 0; /* ensure proper scaling on small screens */
  }
  .cell:hover{
    transform: translateY(-1px);
    border-color:#ffffff2b;
    box-shadow: 0 8px 18px rgba(255,255,255,.08);
  }
  .cell:active{ transform: translateY(0) }
  .cell.disabled{ cursor:not-allowed; opacity:.93 }

  /* GIF icon container */
  .gif-icon{
    width: 64%;
    aspect-ratio: 1;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    transform: scale(.96);
    opacity: 0;
    animation: pop .24s ease forwards;
    filter: drop-shadow(0 6px 16px rgba(255,255,255,.17));
  }
  @keyframes pop{ to{ transform: scale(1); opacity:1 } }

  /* subtle shine sweep */
  .shine{
    position:absolute; inset:0; pointer-events:none; opacity:0;
    background: linear-gradient(130deg, #ffffff00 20%, #ffffff18 50%, #ffffff00 80%);
    transform: translateX(-120%);
    filter: blur(0.4px);
  }
  .cell.placed .shine{ opacity:1; animation: sweep .6s ease forwards; }
  @keyframes sweep{ to { transform: translateX(120%); opacity:.0 } }

  /* winning overlay line */
  .overlay{ position:relative; }
  .win-svg{
    position:absolute; inset:12px; /* matches board-card padding */
    pointer-events:none;
  }
  .win-svg line{
    stroke: var(--win);
    stroke-width: 10;
    stroke-linecap: round;
    stroke-dasharray: 0 1000;
    animation: win-line .56s cubic-bezier(.16,.84,.2,1) forwards;
    filter: drop-shadow(0 10px 20px rgba(198,255,179,.32));
  }
  @keyframes win-line{ to { stroke-dasharray: 1000 0 } }

  .controls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
  .btn{
    appearance:none; border:none; cursor:pointer; font-weight:900; letter-spacing:.3px;
    padding:10px 12px; border-radius:12px; color:#0b0d10;
    background: linear-gradient(135deg,#ffffff,#cfcfcf);
    box-shadow: 0 6px 18px rgba(255,255,255,.22);
    transition: transform .12s ease, box-shadow .2s ease;
    font-size:14px;
  }
  .btn:hover{ transform: translateY(-1px) }
  .btn:active{ transform: translateY(0) }
  .btn.alt{
    color:#0b0d10;
    background: linear-gradient(135deg,#c1ffd8,#e8fff3);
    box-shadow: 0 6px 18px rgba(193,255,216,.22);
  }

  .subtle{ color:var(--muted); font-size:12px; opacity:.9 }
</style>
  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js')
    .then(() => console.log('Service Worker Registered'));
}
  </script>
</head>
<body>
  <div class="app">
    <div class="title">
      <div class="spark"></div>
      Tic Tac Toe
    </div>

    <div class="row controls">
      <div class="toggle">
        <input id="mode" class="switch" type="checkbox"/>
        <div>
          <div style="font-weight:800">VS Computer</div>
          <div class="subtle">Toggle singleâ€‘player (minimax)</div>
        </div>
      </div>
      <div class="status">Turn: <span id="turn">X</span><span class="badge" id="badge">Playing</span></div>
      <div style="display:flex; gap:8px">
        <button id="reset" class="btn">Restart</button>
        <button id="swap" class="btn alt">Swap First</button>
      </div>
    </div>

    <div class="board-card overlay">
      <div id="board" class="board" aria-label="Tic Tac Toe board"></div>
      <svg class="win-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
        <line id="winLine" x1="0" y1="0" x2="0" y2="0" opacity="0"/>
      </svg>
    </div>

    <div class="row" style="justify-content:center">
      <div class="subtle">made by saad.</div>
    </div>
  </div>

<script>
(function(){
  const boardEl = document.getElementById('board');
  const turnEl  = document.getElementById('turn');
  const badgeEl = document.getElementById('badge');
  const resetEl = document.getElementById('reset');
  const swapEl  = document.getElementById('swap');
  const modeEl  = document.getElementById('mode');
  const winLine = document.getElementById('winLine');

  const WINS = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  let cells = Array(9).fill(null);
  let playing = true;
  let first = 'X';
  let turn = 'X';
  let vsCPU = false;

  function makeCell(i){
    const btn = document.createElement('button');
    btn.className = 'cell';
    btn.setAttribute('aria-label','Cell '+(i+1));
    btn.dataset.i = i;

    const shine = document.createElement('div');
    shine.className = 'shine';
    btn.appendChild(shine);

    btn.addEventListener('click', onClick);
    return btn;
  }

  function renderBoard(){
    boardEl.innerHTML='';
    for(let i=0;i<9;i++) boardEl.appendChild(makeCell(i));
  }

  function setGif(el, who){
    const icon = document.createElement('div');
    icon.className = 'gif-icon';
    icon.style.backgroundImage = who === 'X' ? 'url("./x.png")' : 'url("./o.png")';
    el.appendChild(icon);
    el.classList.add('placed');
  }

  function onClick(e){
    const i = +e.currentTarget.dataset.i;
    if(!playing || cells[i]) return;
    move(i, turn);

    if(vsCPU && playing && turn !== first){
      setTimeout(cpuTurn, 260); // snappier on compact UI
    }
  }

  function move(i, p){
    cells[i] = p;
    const el = boardEl.children[i];
    el.classList.add('disabled');
    setGif(el, p);
    evaluate();
  }

  function winner(board){
    for(const [a,b,c] of WINS){
      if(board[a] && board[a]===board[b] && board[a]===board[c]) return {p:board[a], line:[a,b,c]};
    }
    return null;
  }

  function evaluate(){
    const w = winner(cells);
    if(w){
      playing=false;
      badgeEl.textContent='Winner: '+w.p;
      turnEl.textContent = w.p;
      drawWin(w.line);
      disableAll();
      return;
    }
    if(cells.every(Boolean)){
      playing=false;
      badgeEl.textContent='Draw';
      badgeEl.style.background = 'linear-gradient(135deg, #ffe29a, #ffb3a0)';
      turnEl.textContent='-';
      disableAll();
      return;
    }
    swapTurn();
  }

  function swapTurn(){
    turn = (turn==='X') ? 'O' : 'X';
    turnEl.textContent = turn;
    badgeEl.textContent = 'Playing';
    badgeEl.style.background = 'linear-gradient(135deg, #f5f5f5, #cfcfcf)';
  }

  function disableAll(){
    for(const el of boardEl.children) el.classList.add('disabled');
  }

  function enableEmpty(){
    for(let i=0;i<9;i++){
      const el = boardEl.children[i];
      if(!cells[i]) el.classList.remove('disabled');
    }
  }

  function reset(){
    cells = Array(9).fill(null);
    playing = true;
    turn = first;
    turnEl.textContent = turn;
    badgeEl.textContent = 'Playing';
    badgeEl.style.background = 'linear-gradient(135deg, #f5f5f5, #cfcfcf)';
    clearWin();
    renderBoard();

    if(vsCPU && turn !== human()){
      setTimeout(cpuTurn, 220);
    }
  }

  function human(){ return first; }

  // Minimax with alpha-beta pruning for optimal CPU
  function cpuTurn(){
    if(!playing) return;
    const ai = (first==='X') ? 'O' : 'X';
    const humanP = first;

    const best = bestMove(cells, ai, humanP);
    if(best.index != null){
      move(best.index, ai);
    }
  }

  function bestMove(board, ai, humanP){
    let best = {score: -Infinity, index: null};
    for(const i of emptySquares(board)){
      board[i] = ai;
      const score = minimax(board, 0, false, ai, humanP, -Infinity, Infinity);
      board[i] = null;
      if(score > best.score){
        best = {score, index:i};
      }
    }
    return best;
  }

  function minimax(board, depth, isMax, ai, humanP, alpha, beta){
    const res = winner(board);
    if(res){
      if(res.p === ai)   return 10 - depth;
      if(res.p === humanP) return depth - 10;
    }
    if(isFull(board)) return 0;

    if(isMax){
      let maxEval = -Infinity;
      for(const i of emptySquares(board)){
        board[i] = ai;
        const evalScore = minimax(board, depth+1, false, ai, humanP, alpha, beta);
        board[i] = null;
        maxEval = Math.max(maxEval, evalScore);
        alpha = Math.max(alpha, evalScore);
        if(beta <= alpha) break;
      }
      return maxEval;
    }else{
      let minEval = Infinity;
      for(const i of emptySquares(board)){
        board[i] = humanP;
        const evalScore = minimax(board, depth+1, true, ai, humanP, alpha, beta);
        board[i] = null;
        minEval = Math.min(minEval, evalScore);
        beta = Math.min(beta, evalScore);
        if(beta <= alpha) break;
      }
      return minEval;
    }
  }

  function emptySquares(board){
    const arr=[];
    for(let i=0;i<9;i++) if(!board[i]) arr.push(i);
    return arr;
  }
  function isFull(board){ return board.every(Boolean); }

  function drawWin(lineIdxs){
    const map = (i)=>{
      const r = Math.floor(i/3), c = i%3;
      const step = 100/3;
      return [c*step + step/2, r*step + step/2];
    };
    const [a,,c] = lineIdxs;
    const [x1,y1] = map(a);
    const [x2,y2] = map(c);
    winLine.setAttribute('x1', x1);
    winLine.setAttribute('y1', y1);
    winLine.setAttribute('x2', x2);
    winLine.setAttribute('y2', y2);
    winLine.setAttribute('opacity','1');
    winLine.style.animation='none'; void winLine.offsetWidth; winLine.style.animation=null;
  }

  function clearWin(){
    winLine.setAttribute('opacity','0');
    winLine.setAttribute('x1','0'); winLine.setAttribute('y1','0');
    winLine.setAttribute('x2','0'); winLine.setAttribute('y2','0');
  }

  // events
  resetEl.addEventListener('click', reset);
  swapEl.addEventListener('click', ()=>{
    first = (first==='X') ? 'O' : 'X';
    reset();
  });
  modeEl.addEventListener('change', e=>{
    vsCPU = e.target.checked;
    reset();
  });

  // init
  renderBoard();
})();
</script>
</body>
</html>
